<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <!-- Your head content -->
</head>
<body>
<h1>Expenses</h1>

<!-- search by keyword -->
<p>
<form th:action="@{/expenses/search}" method="get">
  <input type="hidden" name="searchTerm" th:value="${searchTerm}" />
  <input type="text" name="searchTermInput" placeholder="Search expenses..." required th:value="${searchTerm}" />
  <button type="submit">Search</button>
</form>
</p>

<!-- Filter by date -->
<p>
<form th:action="@{/expenses/filter}" method="get">
  <input type="date" name="startDate" required>
  <input type="date" name="endDate" required>
  <button type="submit">Filter</button>
</form>
</p>

<!-- Display the filter results count -->
<p th:if="${filteredCount != null}" th:text="'Number of results: ' + ${filteredCount}"></p>

<!-- Display a message if no results were found -->
<p th:if="${filteredCount != null and filteredCount == 0}">No results found.</p>

<!-- Display the search results count -->
<p th:if="${searchCount != null}" th:text="'Number of results: ' + ${searchCount}"></p>

<!-- Display a message if no results were found -->
<p th:if="${searchCount != null and searchCount == 0}">No results found.</p>

<form th:action="@{/expenses/updateCategory(searchTerm=${searchTerm})}" method="post" th:withQueryString="true">
  <select name="categoryId">
    <option value="">Select Category</option>
    <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.category}"></option>
  </select>
  <button type="submit">Update</button>

  <table>
    <!-- Table headers -->
    <tr>
      <th>Date</th>
      <th>Entity</th>
      <th>Credit/Debit</th>
      <th>Amount</th>
      <th>Description</th>
      <th>Category</th>
      <th><input type="checkbox" id="selectAll" /></th> <!-- Add the "Select All" checkbox -->
    </tr>

    <!-- Table rows -->
    <tr th:each="expense : ${expenses}">
      <td th:text="${expense.date}"></td>
      <td th:text="${expense.entity}"></td>
      <td th:text="${expense.creditOrDebit}"></td>
      <td th:text="${expense.amount}"></td>
      <td th:text="${expense.description}"></td>
      <td th:text="${expense.categories.size() > 0 ? expense.categories[0].category : ''}"></td>
      <td><input type="checkbox" name="selectedExpenseIds" th:value="${expense.id}" /></td>
    </tr>
  </table>
</form>

<script>
  // Function to toggle the selection of all checkboxes
  function toggleSelectAll() {
    const checkboxes = document.querySelectorAll('input[name="selectedExpenseIds"]');
    const selectAllCheckbox = document.getElementById('selectAll');

    checkboxes.forEach((checkbox) => {
      checkbox.checked = selectAllCheckbox.checked;
    });
  }

  // Add event listener to the "Select All" checkbox
  const selectAllCheckbox = document.getElementById('selectAll');
  selectAllCheckbox.addEventListener('change', toggleSelectAll);
</script>

</body>
</html>
